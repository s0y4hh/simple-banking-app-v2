{% extends "base.html" %} {% block content %}
<div class="row">
  <div class="col-lg-8 offset-lg-2">
    <h2 class="mb-4">Account Summary</h2>

    <!-- Balance Card -->
    <div class="card balance-card mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h5 class="card-title">Current Balance</h5>
            <h2 class="display-4">
              <span id="balance-value">
                {% if show_balance %} ₱{{ "%.2f"|format(current_user.balance) }}
                {% else %}
                <span class="blurred-balance">••••••••</span>
                {% endif %}
              </span>
              <button
                id="toggle-balance-btn"
                class="btn btn-link btn-sm align-baseline"
                type="button"
                title="Show/Hide Balance"
              >
                <i
                  id="eye-icon"
                  class="bi {{ 'bi-eye-slash' if not show_balance else 'bi-eye' }}"
                ></i>
              </button>
            </h2>
            <p class="mt-2">
              Account Number: <strong>{{ current_user.account_number }}</strong>
            </p>
          </div>
          <div class="col-md-6 text-end">
            <a href="{{ url_for('transfer') }}" class="btn btn-light mt-3"
              >Make a Transfer</a
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Transaction History -->
    <div class="card">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <h5 class="mb-0">Recent Transactions</h5>
      </div>
      <div class="card-body">
        {% if transactions %} {% for transaction in transactions %} {% if
        transaction.sender_id == current_user.id %}
        <div class="transaction-item sent">
          <div class="d-flex justify-content-between">
            <div>
              <strong>Sent to:</strong> {{ transaction.receiver.username }} ({{
              transaction.receiver.account_number }})
              <div class="text-secondary small">
                {{ transaction.timestamp.strftime('%Y-%m-%d %H:%M') }}
              </div>
            </div>
            <div class="text-danger fw-bold">
              -₱{{ "%.2f"|format(transaction.amount) }}
            </div>
          </div>
        </div>
        {% else %}
        <div class="transaction-item received">
          <div class="d-flex justify-content-between">
            <div>
              {% if transaction.transaction_type == 'deposit' %}
              <strong>Deposit by:</strong> {{ transaction.sender.username }}
              <div class="text-secondary small">
                {{ transaction.timestamp.strftime('%Y-%m-%d %H:%M') }}
              </div>
              {% else %}
              <strong>Received from:</strong> {{ transaction.sender.username }}
              ({{ transaction.sender.account_number }})
              <div class="text-secondary small">
                {{ transaction.timestamp.strftime('%Y-%m-%d %H:%M') }}
              </div>
              {% endif %}
            </div>
            <div class="text-success fw-bold">
              +₱{{ "%.2f"|format(transaction.amount) }}
            </div>
          </div>
        </div>
        {% endif %} {% endfor %} {% else %}
        <div class="text-center p-4">
          <p class="text-muted">No transactions yet.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btn = document.getElementById("toggle-balance-btn");
    if (btn) {
      btn.addEventListener("click", function () {
        fetch("{{ url_for('toggle_balance_visibility') }}", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token() }}",
          },
          credentials: "same-origin",
        })
          .then((response) => response.json())
          .then((data) => {
            // Reload the page to update all balance displays
            window.location.reload();
          });
      });
    }
  });
</script>
<style>
  .blurred-balance {
    letter-spacing: 0.2em;
    filter: blur(2px);
    user-select: none;
  }
</style>
{% endblock %}
